<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>趋势报告</title>
</head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <link rel="stylesheet" href="/resources/website/css/share.css"/>
    <link rel="stylesheet" href="/resources/website/css/style.css"/>

<body>
<div class="share_container">
    <div class="share_box">
        <p class="share_title">所有趋势报告</p>
        <!--中-->
        <div class="share_containerMid2">
            <!--甲醛-->
            <div class="share_chartBox2">
                <p class="share_chartP">
                    <span class="share_chartTitle">甲醛</span>
                    <span class="share_chartDate">${ month }月<br/><span class="fS18">${ year }</span></span>
                </p>
                <div class="share_chart2" >
                    <div style="overflow:hidden;" class="figurebox2">
                        <div id="reference1" style="position: absolute;" class="figurebox2"></div>
                        <div style="overflow:hidden;margin-left:40px">
                            <div id="div1" class="figurebox2" style="overflow:hidden;margin-left:0px">
                                <div class="maskPrompt">
                                    <!-- 周一<br/>12 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--PM2.5-->
            <div class="share_chartBox2">
                <p class="share_chartP">
                    <span class="share_chartTitle">PM2.5</span>
                    <span class="share_chartDate">${ month }月<br/><span class="fS18">${ year }</span></span>
                </p>
                <div class="share_chart2" >
                    <div style="overflow:hidden;" class="figurebox2">
                        <div id="reference2" style="position: absolute;" class="figurebox2"></div>
                        <div style="overflow: hidden;margin-left:40px">
                            <div id="div2" class="figurebox2" style="overflow:hidden;margin-left:0px">
                                <div class="maskPrompt">
                                   <!--  周一<br/>12 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--TVOC-->
            <div class="share_chartBox2">
                <p class="share_chartP">
                    <span class="share_chartTitle">TVOC</span>
                    <span class="share_chartDate">${ month }月<br/><span class="fS18">${ year }</span></span>
                </p>
                <div class="share_chart2" >
                    <div style="overflow:hidden;" class="figurebox2">
                        <div id="reference3" style="position: absolute;" class="figurebox2"></div>
                        <div style="overflow: hidden;margin-left:40px">
                            <div id="div3" class="figurebox2" style="overflow:hidden;margin-left:0px">
                                <div class="maskPrompt">
                                    <!-- 周一<br/>12 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--CO-->
            <div class="share_chartBox2">
                <p class="share_chartP">
                    <span class="share_chartTitle">CO</span>
                    <span class="share_chartDate">${ month }月<br/><span class="fS18">${ year }</span></span>
                </p>
                <div class="share_chart2" >
                    <div style="overflow:hidden;" class="figurebox2">
                        <div id="reference4" style="position: absolute;" class="figurebox2"></div>
                        <div style="overflow: hidden;margin-left:40px">
                            <div id="div4" class="figurebox2" style="overflow:hidden;margin-left:0px">
                                <div class="maskPrompt">
                                    <!-- 周一<br/>12 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--文字-->
		    <p class="share_P2">&nbsp;&nbsp;&nbsp;依据GB/T18883－2002《室内空气质量标准》，采用</p>
		    <a class="share_P2">&nbsp;&nbsp;&nbsp;&nbsp;国家标准试剂法，该居室内环境温度为25°，环境湿度为</a>
		    <a class="share_P2">&nbsp;&nbsp;&nbsp;&nbsp;50%。</a>
		    <p class="share_title2">&nbsp;甲醛的来源:</p>
		    <p class="share_P3">&nbsp;1、胶合板、细木工板、中密度纤维板和刨花板等人造板材及其</p>
		    <a class="share_P3">&nbsp;家具制品；</a>
		    <p class="share_P3">&nbsp;2、地板、墙纸等大量使用胶粘剂的室内装饰物；</p>
		    <p class="share_P3">&nbsp;3、部分油漆、涂料、胶粘剂中也含有甲醛。</p>
		    <p class="share_title2">&nbsp;甲醛的危害：</p>
		    <p class="share_P3">&nbsp;1、 刺激作用：甲醛对眼睛和呼吸系统有强烈刺激，常见症状有</p>
		    <a class="share_P3">&nbsp;流泪、咳嗽、打喷嚏、咽喉炎、结膜炎、支气管痉挛等。</a>
		    <p class="share_P3">&nbsp;2、致癌作用：世界卫生组织（WHO）认定甲醛为致癌物质。</p>
		    <p class="share_aBox"><a class="share_a" href="javascript:0">&nbsp;>> 推荐给好友</a></p>
        </div>
        <!--下-->
        <div class="share_containerBtm">
            <p class="share_Btmtitle">关注青核桃</p>
            <p class="share_P4"><span class="share_point"></span><a href="https://item.taobao.com/item.htm?spm=a230r.1.14.1.cji1cD&id=45023603127&ns=1&abbucket=14#detail"><span class="share_sp colorO">淘宝官方店铺</span></a></p>
            <p class="share_P4"><span class="share_point"></span><a href="https://item.taobao.com/item.htm?spm=a230r.1.14.50.cji1cD&id=43497270377&ns=1&abbucket=14#detail"><span class="share_sp colorO">官方微店店铺</span></a></p>
        </div>
        <!--下载-->
        <div class="share_download">
            <a href="http://www.qhetao.com/"><img class="share_downloadLogo" src="/resources/website/img/logo.png" alt=""/></a>
            <a class="share_downloadBtn" style="display:none" href="${apk_download}">下载APP</a>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="/resources/website/js/svg-graphic.js"></script>
<script>
    (function (doc, win) {
        var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
                    docEl.style.fontSize = 20 * (clientWidth / 640) + 'px';
                };

        if (!doc.addEventListener) return;
        win.addEventListener(resizeEvt, recalc, false);
        doc.addEventListener('DOMContentLoaded', recalc, false);
    })(document, window);
    //    甲醛数据传送到这
    window.onload = function() {
//        这里是你传过来的数据
        /* var data = '[[{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"}],' +
                '[{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"}],' +
                '[{"x":"2015-08-28 13:58:49","y":"15.0"},{"x":"2015-08-28 13:58:49","y":"23.0"},{"x":"2015-08-28 13:58:49","y":"15.0"},{"x":"2015-08-28 13:58:49","y":"23.0"},{"x":"2015-08-28 13:58:49","y":"15.0"},{"x":"2015-08-28 13:58:49","y":"23.0"},{"x":"2015-08-28 13:58:49","y":"15.0"},{"x":"2015-08-28 13:58:49","y":"23.0"},{"x":"2015-08-28 13:58:49","y":"15.0"},{"x":"2015-08-28 13:58:49","y":"23.0"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"},{"x":"2015-08-28 13:58:49","y":"20.7"},{"x":"2015-08-28 13:58:49","y":"26.5"}],' +
                '[{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"},{"x":"2015-08-28 13:58:49","y":"0.19"},{"x":"2015-08-28 13:58:49","y":"0.09"}]]' //        这里是你传的数据 */
        var data = '${data}';
        var bigData = eval(data);
        /* var endDate="2015-09-08";
        var dateType=parseInt(7); */
        var endDate = "${currentDate}";
        var dateType = parseInt('${dateType}');
//        这个是传过来的结束节点 end
  		function getDate(endDate, bigData, category, days) {
            var time = [], allData = [], dataX = {};
//        取出各个数据
        if (days == 7) {
            for (var i = 0; i < 7; i++) {
                for (var j = 0; j < 6; j++) {
                    var dataDate = 0, starTime = new Date(endDate);
                    var Time = "", allTime = "";
                    starTime.setDate(starTime.getDate() + i - 7);
                    dataDate = starTime.getFullYear() + "-" + setM(starTime.getMonth() + 1) + "-" + starTime.getDate();
                    switch (j) {
                        case 0:
                            Time = "3:00:00";
                            break;
                        case 1:
                            Time = "7:00:00";
                            break;
                        case 2:
                            Time = "11:00:00";
                            break;
                        case 3:
                            Time = "15:00:00";
                            break;
                        case 4:
                            Time = "19:00:00";
                            break;
                        case 5:
                            Time = "23:00:00";
                            break;
                        default :
                            ;
                    }
                    time.push(dataDate + " " + Time);
                }
            }
        }
        else if (days == 15) {
            for (var i = 0; i < 15; i++) {
                for (var j = 0; j < 3; j++) {
                    var dataDate = 0, starTime = new Date(endDate);
                    var Time = "", allTime = "";
                    starTime.setDate(starTime.getDate() + i - 15);
                    dataDate = starTime.getFullYear() + "-" + setM(starTime.getMonth() + 1) + "-" + starTime.getDate();
                    switch (j) {
                        case 0:
                            Time = "7:00:00";
                            break;
                        case 1:
                            Time = "15:00:00";
                            break;
                        case 2:
                            Time = "23:00:00";
                            break;
                        default :
                            ;
                    }
                    time.push(dataDate + " " + Time);
                }
            }
        } else {
            for( var k = 0; k < bigData.length; k++){

                allData.push({x:bigData[k]["testDate"],y:bigData[k][category]});
            }
            return allData;
        }

        for (var m = 0; m < time.length; m++) {
            allData.push({x: time[m], y: search(time[m], bigData)});
        }

        function search(str1, str2) {
            var y = 0;
            for (var i = 0; i < str2.length; i++) {
                if (str1 == str2[i]["testDate"]) {
                    y = str2[i][category];
                }
            }
            return y;
        }

        return allData;
    }

    function setM(num) {
        if (num + 1 < 10) {
            return "0" + num;
        } else {
            return num;
        }
    }
        var oDiv1 = document.getElementById("div1");
        var oDiv2=document.getElementById("div2");
        var oDiv3=document.getElementById("div3");
        var oDiv4=document.getElementById("div4");
        var dataBaseArr = 0,dataTemArr = 0,dataHumArr = 0,dataPmArr =0;
        //        主要fun
        function getData(bigData){
            console.log(bigData)
            var dataArr = 0,temperatureArr = 0,humidityArr = 0,biggestDataArr = [],biggestData = 0,pmdityArry = 0;
            dataArr = bigData[0];temperatureArr = bigData[1];humidityArr = bigData[2];pmdityArry= bigData[3];
            for(var i = 0 ; i < dataArr.length ; i++){
                biggestDataArr.push(dataArr[i]['y']);
            }
            biggestData = bubbling(biggestDataArr);
            dataBaseArr = dataArr;
            dataTemArr = temperatureArr;
            dataHumArr = humidityArr;
            dataPmArr = pmdityArry;
        }
        //        选出最大值
        function bubbling(dataArr){
            var biggest = dataArr[0];
            for(var i = 0 ; i < dataArr.length ; i++){
                if(biggest < dataArr[i]){
                    biggest = dataArr[i];
                }
            }
            return biggest;
        }
        //        转换y值，以百分比形式
        function changeY(dataArr,biggestData){
            for(var i = 0; i < dataArr.length; i++ ){
                dataArr[i]['y'] = (biggestData/100*dataArr[i]['y']).toFixed(3);
            }
            return dataArr;
        }

        getData(bigData);
        oDiv1.style.width=parseInt(bigData[0].length*40)+"px";
        oDiv1.addEventListener('touchstart',function(){
            touchDownX = event.targetTouches[0].pageX;
        });
        oDiv1.setAttribute("ClipToBounds","True")
        //Div1滑动效果
        oDiv1.addEventListener('touchmove',function(){
            var touchMoveX=event.targetTouches[0].pageX;
            if(parseInt(touchMoveX-touchDownX)<=0){
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])-10+"px";
            }else{
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])+10+"px";
            }
            touchDownX=touchMoveX;
            console.log(this.style.left.split("px")[0])
        });
        oDiv1.addEventListener('touchend',function(){
            if(parseInt(this.style.marginLeft.split("px")[0])>0||bigData[0].length*40<window.screen.availWidth){
                this.style.marginLeft="0px";
            }
            if(bigData[0].length*40-window.screen.availWidth>=0&&parseInt(this.style.marginLeft.split("px")[0])<-1*(bigData[0].length*40-window.screen.availWidth)){
                this.style.marginLeft=-1*(bigData[0].length*40-oReference1.offsetWidth+40)+"px";
            }
            console.log();
        })
        oDiv2.style.width=parseInt(bigData[1].length*40)+"px";
        oDiv2.addEventListener('touchstart',function(){
            touchDownX = event.targetTouches[0].pageX;
        });
        oDiv2.setAttribute("ClipToBounds","True")
        //Div2滑动效果
        oDiv2.addEventListener('touchmove',function(){
            var touchMoveX=event.targetTouches[0].pageX;
            if(parseInt(touchMoveX-touchDownX)<=0){
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])-10+"px";
            }else{
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])+10+"px";
            }
            touchDownX=touchMoveX;
        });
        oDiv2.addEventListener('touchend',function(){
            if(parseInt(this.style.marginLeft.split("px")[0])>0||bigData[1].length*40<window.screen.availWidth){
                this.style.marginLeft="0px";
            }
            if(bigData[0].length*40-window.screen.availWidth>=0&&parseInt(this.style.marginLeft.split("px")[0])<-1*(bigData[1].length*40-window.screen.availWidth)){
                this.style.marginLeft=-1*(bigData[1].length*40-oReference2.offsetWidth+40)+"px"
            }
        })
        oDiv3.style.width=parseInt(bigData[2].length*40)+"px";
        oDiv3.addEventListener('touchstart',function(){
            touchDownX = event.targetTouches[0].pageX;
        });
        oDiv3.setAttribute("ClipToBounds","True")
        //Div3滑动效果
        oDiv3.addEventListener('touchmove',function(){
            var touchMoveX=event.targetTouches[0].pageX;
            if(parseInt(touchMoveX-touchDownX)<=0){
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])-10+"px";
            }else{
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])+10+"px";
            }
            touchDownX=touchMoveX;
        });
        oDiv3.addEventListener('touchend',function(){
            if(parseInt(this.style.marginLeft.split("px")[0])>0||bigData[2].length*40<window.screen.availWidth){
                this.style.marginLeft="0px";
            }
            if(bigData[2].length*40-window.screen.availWidth>=0&&parseInt(this.style.marginLeft.split("px")[0])<-1*(bigData[2].length*40-window.screen.availWidth)){
                this.style.marginLeft=-1*(bigData[2].length*40-oReference3.offsetWidth+40)+"px"
            }
        })
        oDiv4.style.width=parseInt(bigData[3].length*40)+"px";
        oDiv4.addEventListener('touchstart',function(){
            touchDownX = event.targetTouches[0].pageX;
        });
        oDiv4.setAttribute("ClipToBounds","True")
        //滑动效果
        oDiv4.addEventListener('touchmove',function(){
            var touchMoveX=event.targetTouches[0].pageX;
            if(parseInt(touchMoveX-touchDownX)<=0){
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])-10+"px";
            }else{
                this.style.marginLeft=parseInt(this.style.marginLeft.split("px")[0])+10+"px";
            }
            touchDownX=touchMoveX;
            console.log(this.style.left.split("px")[0])
        });
        oDiv4.addEventListener('touchend',function(){
            if(parseInt(this.style.marginLeft.split("px")[0])>0||bigData[3].length*40<window.screen.availWidth){
                this.style.marginLeft="0px";
            }
            if(bigData[3].length*40-window.screen.availWidth>=0&&parseInt(this.style.marginLeft.split("px")[0])<-1*(bigData[3].length*40-window.screen.availWidth)){
                this.style.marginLeft=-1*(bigData[3].length*40-oReference4.offsetWidth+40)+"px"
            }
        })
        var d1 = new CreatLine(), d2 = new CreatLine(), d3 = new CreatLine(), d4 = new CreatLine();
        var oReference1=document.getElementById("reference1"),oReference2=document.getElementById("reference2"),
                oReference3=document.getElementById("reference3"),oReference4=document.getElementById("reference4");
        d1.createY(oReference1);d2.createY(oReference2);d3.createY(oReference3);d4.createY(oReference4);

//        甲醛
        d1.init(oDiv1, {
            type:"",
            data:dataBaseArr
        });
//        PM2.5
        d2.init(oDiv2, {
            type: "",
            data:dataTemArr
        });
//        TVOC
        d3.init(oDiv3, {
            type: "",
            data:dataHumArr
    });
//        CO
        d4.init(oDiv4, {
            type: "",
            data: dataPmArr
        });
        function creatTage(tageName,json){//创建标签方法
            var oTage = document.createElementNS(svgNs,tageName);
            for(var attr in json){
                oTage.setAttribute(attr,json[attr]);
            }
            return oTage;
        }
    }

</script>
</html>